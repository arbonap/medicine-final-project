{% extends 'base.html' %}
{% block content %}

<h1> Hello and welcome, {{ user.first_name }} ! </h1>
<br>
<h2> You are currently signed in as {{ user.email }} </h2>

<h4>
    <a href="/logout">Click here to sign out </a>
</h4>
<div id="prescription-html">
<h3>This is your prescription dashboard:</h3>
<br>
{{ meds }}
<br>
This is your user profile object: <br>
{{ user }}
<br>
<i>Prescription information: </i>


{% for med in meds %}
    <br/>
    <ol>Medication name: {{ med.med_name }}</ol>
    <ul>
        <li>Reason for taking medication: {{ med.reason }}</li>
        <li>Is this taken with food? {{ med.food }} </li>
        <li>Is this taken with drink? {{ med.drink }} </li>
        <li> Each time you take this medicine, how many units of this medicine do you take? {{ med.dosage_quantity }} </li>
        <br/>
    </ul>
{% endfor %}


<ul>
    <!-- the following loops over dictionary created in server.py: -->
    {% for m in meds %}
        <li>{{ m.med_name }}
            <ul>
                {% for time in m.schedule %}
                    <li>{{ time.timestamp }}</li>
                {% endfor %}
            </ul>
        </li>
    {% endfor %}
</ul>
<br>
<br>

<button id="email-button" type="button">Email me upcoming prescription information</button>


    <form action="/send-email" method="POST">
                  <label>Email: <input type="text" name="email"></label>
                  <input id="hidden-form" type="hidden" name="html" value="">
                  <input type="submit" value="send">
              </form>
<script>
    "use strict";
// JQuery that submits a hidden form
// that copies and pastes all of the HTML
// on the prescription dashboard page
// so that flask can email user their information

var emailButton = $("#email-button");

function updateForm() {
   $('#hidden-form')[0].value = $('#prescription-html')[0]
   console.log($('#hidden-form')[0].value[0]);

}

// Event Listener
emailButton.click(updateForm);
</script>
{% endblock %}

